!function(a,b){"use strict";var c,d,e,f,g={},h={},i=[],j={},k={poll:25,html5:!1,force:!1};h.setup=function(b){var c=k.html5&&"pushState"in a.history?"popstate":"hashchange";if(k.force&&h.force(),"on"+c in a)h.listen(a,c,b);else{var d=a.location.href;setInterval(function(){var c=a.location.href;d!==c&&(d=c,b.call(a))},k.poll)}},h.force=function(){for(var a=b.getElementsByTagName("a"),c=function(){var a=this.getAttribute("href"),b=h.sanitize(a.substr(a.indexOf("#")+1));b===f&&h.change()},d=0;d<a.length;d++){var e=a[d];e.hasAttribute("href")&&-1!==e.getAttribute("href").indexOf("#")&&h.listen(e,"click",c)}},h.promise=function(){var a=this;a.stack=[],a.then=function(b){a.stack.push(b)},a.resolve=function(){for(;a.stack.length;)return a.stack.shift().call(c)}},h.route=function(a,b){var c=[];a="^"+a,a=a.replace(/(\?)?\{([^}]+)\}/g,function(a,b,d){return c.push({name:d,optional:"undefined"!=typeof b?!0:!1}),"([^{}\\/]+)?"}).replace(/\//g,"\\/?"),a+="\\/?$",i.push({regex:new RegExp(a),params:c,directions:b})},h.change=function(){f=h.state();var b=h.match(f);if(b){var i=g;g=b.params;var j=h.dispatch("change",g,i);k.html5&&"pushState"in a.history&&a.history.replaceState(h.extend(g,{hash:f}),"{Satnav}","/"+f);var l=function(){b.directions.call(c,g)};j instanceof h.promise?e.then(l):l()}else a.location.hash=d||""},h.sanitize=function(a){return a.replace(/^\//g,"")},h.match=function(a){for(var b in i){var c=i[b],d=a.match(c.regex);if(d){for(var e={},f=1,g=d.length;g>f;f++){if("undefined"==typeof d[f]&&!c.params[f-1].optional)throw new Error("[Satnav] A required route parameter was not defined");"undefined"!=typeof d[f]&&(e[c.params[f-1].name]=d[f])}return{directions:c.directions,params:e}}}return void 0},h.dispatch=function(a){var b=Array.prototype.slice.call(arguments,1);return a in j&&j[a].apply(c,b)},h.state=function(){return a.history.state&&a.history.state.hash?a.history.state.hash:h.sanitize(a.location.hash.substr(1))},h.extend=function(a,b){for(var c in b)a[c]=a.hasOwnProperty(c)?a[c]:b[c];return a},h.listen=function(){return a.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:a.attachEvent?function(a,b,c){a.attachEvent("on"+b,function(){c.call(a)},!1)}:void 0}(),c=function(a){return k=h.extend(a,k),c},c.defer=function(){return e=new h.promise}(),c.resolve=function(){setTimeout(e.resolve,1)},c.navigate=function(a){if(!("path"in a))throw new Error("[Satnav] A required argument was not defined");return 0===i.length&&h.setup(h.change),h.route(h.sanitize(a.path),"directions"in a?a.directions:function(){}),c},c.otherwise=function(a){return d="string"==typeof a?h.sanitize(a):"path"in a?h.sanitize(a.path):"",c},c.change=function(a){return j.change=a,c},c.go=function(){return h.change(),c},"function"==typeof a.define&&a.define.amd?a.define("Satnav",[],function(){return c}):"undefined"!=typeof a.module&&a.module.exports?a.module.exports=c:a.sN=a.Satnav=c}(window,document);
